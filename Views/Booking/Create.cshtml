@model ProjectName.Models.Booking

@{
    ViewData["Title"] = Model.BookingId == 0 ? "إضافة حجز" : "تعديل الحجز";
}

<h2>@ViewData["Title"]</h2>

<form asp-action="@(Model.BookingId == 0 ? "Create" : "Edit")" method="post">
    <div class="form-group">
        <label asp-for="CustomerName"></label>
        <input asp-for="CustomerName" class="form-control" placeholder="اسم العميل" />
        <span asp-validation-for="CustomerName" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="CustomerPhone"></label>
        <input asp-for="CustomerPhone" class="form-control" placeholder="رقم الهاتف" />
        <span asp-validation-for="CustomerPhone" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="StartDate"></label>
        <input asp-for="StartDate" type="date" class="form-control" />
        <span asp-validation-for="StartDate" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="EndDate"></label>
        <input asp-for="EndDate" type="date" class="form-control" />
        <span asp-validation-for="EndDate" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="TotalPrice"></label>
        <input asp-for="TotalPrice" id="TotalPrice" class="form-control" placeholder="السعر الإجمالي (اختياري)" />
        <span asp-validation-for="TotalPrice" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="AmountPaid"></label>
        <input asp-for="AmountPaid" id="AmountPaid" class="form-control" placeholder="المبلغ المدفوع (اختياري)" />
        <span asp-validation-for="AmountPaid" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="AmountRemaining"></label>
        <input asp-for="AmountRemaining" id="AmountRemaining" class="form-control" placeholder="المبلغ المتبقي (يحسب تلقائي)" readonly />
        <span asp-validation-for="AmountRemaining" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Notes"></label>
        <textarea asp-for="Notes" class="form-control" placeholder="ملاحظات (اختياري)"></textarea>
        <span asp-validation-for="Notes" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="BrokerName"></label>
        <input asp-for="BrokerName" class="form-control" placeholder="اسم السمسار (اختياري)" />
        <span asp-validation-for="BrokerName" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="BrokerPhone"></label>
        <input asp-for="BrokerPhone" class="form-control" placeholder="رقم هاتف السمسار (اختياري)" />
        <span asp-validation-for="BrokerPhone" class="text-danger"></span>
    </div>

    <input type="hidden" asp-for="UnitId" />

    <button type="submit" class="btn btn-primary mt-2">@ViewData["Title"]</button>
    <a asp-action="Details" asp-controller="Unit" asp-route-id="@Model.UnitId" class="btn btn-secondary mt-2">رجوع</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function calculateRemaining() {
            var total = parseFloat(document.getElementById("TotalPrice").value) || 0;
            var paid = parseFloat(document.getElementById("AmountPaid").value) || 0;
            document.getElementById("AmountRemaining").value = (total - paid).toFixed(2);
        }

        document.getElementById("TotalPrice").addEventListener("input", calculateRemaining);
        document.getElementById("AmountPaid").addEventListener("input", calculateRemaining);

        // حساب أولي عند تحميل الصفحة في حال تعديل الحجز
        window.addEventListener("load", calculateRemaining);
    </script>
}
